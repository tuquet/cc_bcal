{% extends 'base.html' %}
{% from 'macros.html' import status_badge, asset_status_badge %}

{% block title %}Danh Sách Kịch Bản{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-semibold">Danh Sách Kịch Bản</h1>
    <a href="{{ url_for('ui_create_script') }}" class="inline-block px-4 py-2 bg-sky-600 text-white rounded text-sm font-medium hover:bg-sky-700">Thêm Kịch Bản Mới</a>
</div>

<div class="bg-white shadow-md rounded-lg overflow-hidden">
    <div class="overflow-x-auto">
        <form id="bulk-form" method="post" action="{{ url_for('ui_bulk_update_status') }}">
            <table class="w-full text-sm text-left text-slate-600">
                <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                    <tr>
                        <th scope="col" class="p-4">
                            <input type="checkbox" id="select-all" class="w-4 h-4 text-sky-600 bg-slate-100 border-slate-300 rounded focus:ring-sky-500">
                        </th>
                        <th scope="col" class="px-4 py-3">ID</th>
                        <th scope="col" class="px-4 py-3">Tiêu đề</th>
                        <th scope="col" class="px-4 py-3">Trạng thái</th>
                        <th scope="col" class="px-4 py-3">Audio</th>
                        <th scope="col" class="px-4 py-3">Images</th>
                        <th scope="col" class="px-4 py-3">Transcript</th>
                        <th scope="col" class="px-4 py-3">Cập nhật</th>
                        <th scope="col" class="px-4 py-3">Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {% for script in scripts %}
                    <tr class="bg-white border-b hover:bg-slate-50">
                        <td class="w-4 p-4">
                            <input type="checkbox" name="ids" value="{{ script.id }}" class="row-checkbox w-4 h-4 text-sky-600 bg-slate-100 border-slate-300 rounded focus:ring-sky-500">
                        </td>
                        <td class="px-4 py-2 font-medium text-slate-900">{{ script.id }}</td>
                        <td class="px-4 py-2">{{ script.title }}</td>
                        <td class="px-4 py-2">{{ status_badge(script.status) }}</td>
                        <td class="px-4 py-2">{{ asset_status_badge(script.audio_status) }}</td>
                        <td class="px-4 py-2">{{ asset_status_badge(script.images_status) }}</td>
                        <td class="px-4 py-2">{{ asset_status_badge(script.transcript_status) }}</td>
                        <td class="px-4 py-2 text-slate-500 whitespace-nowrap">{{ script.updated_at.strftime('%d-%m-%Y %H:%M') }}</td>
                        <td class="px-4 py-2">
                            <div class="relative">
                                <button type="button" class="action-toggle text-sm bg-slate-200 hover:bg-slate-300 px-3 py-1 rounded">Hành động</button>
                                <div class="action-menu hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10">
                                    <a href="{{ url_for('ui_edit_script', script_id=script.id) }}" class="block w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-100">Sửa</a>
                                    <button type="button" class="action-item w-full text-left px-3 py-2 text-sm" data-action="open_folder" data-script-json-path="{{ script.script_json_path }}">Mở thư mục</button>
                                    <button type="button" class="action-item w-full text-left px-3 py-2 text-sm" data-action="generate_images" data-script-json-path="{{ script.script_json_path }}">Tạo ảnh</button>
                                    <button type="button" class="action-item w-full text-left px-3 py-2 text-sm" data-action="transcribe" data-script-json-path="{{ script.script_json_path }}">Tách lời</button>
                                    <button type="button" class="action-item w-full text-left px-3 py-2 text-sm" data-action="generate_capcut" data-script-json-path="{{ script.script_json_path }}">Tạo video</button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
</div>

{% endblock %}